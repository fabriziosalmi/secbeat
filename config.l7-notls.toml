# SecBeat L7 WAF Configuration (Docker-compatible, no TLS)
[platform]
environment = "production"
deployment_id = "secbeat-l7-001"
region = "local"
mode = "l7"  # Force L7 WAF mode

# Features (minimal set - disable TLS)
features = [
    "ddos_protection",
    "waf_protection", 
    "metrics",
    "management_api"
]

[network]
public_interface = "0.0.0.0"
public_port = 8443  # Proxy HTTP port
backend_interface = "172.18.0.2"
backend_port = 8080  # Real backend
max_connections = 10000
connection_timeout_seconds = 30
keep_alive_timeout_seconds = 60
buffer_size = 65536

backend_servers = [
    { address = "172.18.0.2:8080", weight = 100, health_check = true }
]

# TLS Configuration (DISABLED for testing)
[network.tls]
enabled = false
cert_path = "certs/cert.pem"
key_path = "certs/key.pem"
min_version = "1.2"
max_version = "1.3"
alpn_protocols = ["h2", "http/1.1"]
client_cert_required = false
ocsp_stapling = false

[ddos]
enabled = true
detection_threshold_multiplier = 2.0
mitigation_duration_seconds = 60
learning_period_seconds = 300

[ddos.rate_limiting]
requests_per_second = 100
burst_size = 200
window_seconds = 60
penalty_duration_seconds = 60

[ddos.connection_limits]
max_connections_per_ip = 10
max_total_connections = 10000
max_new_connections_per_second = 100

[ddos.syn_proxy]
enabled = false  # Disable SYN proxy for L7 mode
cookie_secret = "disabled-for-l7-mode"
listen_port = 8443
handshake_timeout_ms = 5000
max_pending_handshakes = 5000

[ddos.blacklist]
enabled = true
auto_blacklist_enabled = true
violation_threshold = 5
static_whitelist = [
    "127.0.0.0/8",
    "10.0.0.0/8",
    "172.16.0.0/12",
    "192.168.0.0/16"
]
geo_blocking_enabled = false

[waf]
enabled = true
mode = "block"  # Block mode for production
max_request_size_bytes = 1048576
max_header_size_bytes = 8192
max_url_length = 2048
max_query_params = 50

[waf.http_inspection]
inspect_headers = true
inspect_body = true
inspect_url = true
inspect_cookies = true
inspect_user_agent = true
max_body_size_bytes = 524288
allowed_content_types = [
    "application/json",
    "application/x-www-form-urlencoded",
    "multipart/form-data",
    "text/plain"
]

[waf.attack_patterns]
sql_injection = true
xss_detection = true
path_traversal = true
command_injection = true

# Orchestrator disabled
[orchestrator]
enabled = false

# NATS disabled
[nats]
enabled = false

# Management API
[management]
enabled = true
listen_addr = "0.0.0.0:9090"
auth_method = "none"

# Metrics
[metrics]
enabled = true
listen_addr = "0.0.0.0:9191"
prometheus_enabled = true
prometheus_path = "/metrics"

# Health Checks
[health]
enabled = true
listen_addr = "0.0.0.0:8081"
path = "/health"

# Logging
[logging]
level = "info"
format = "json"
outputs = ["stdout"]

# Debug configuration
[debug]
enabled = false
verbosity = "info"
backtrace = false
metrics_detailed = false
