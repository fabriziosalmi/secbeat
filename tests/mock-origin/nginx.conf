# Nginx configuration for mock origin server

server {
    listen 80;
    server_name test-origin;

    # Access logging for debugging
    access_log /var/log/nginx/access.log combined;
    error_log /var/log/nginx/error.log warn;

    # Root directory
    root /usr/share/nginx/html;

    # Health check endpoint (JSON response)
    location /health {
        default_type application/json;
        return 200 '{"status":"healthy","service":"mock-origin","timestamp":"$date_gmt"}';
        add_header Content-Type application/json;
        add_header X-Server-Name test-origin;
    }

    # Homepage
    location / {
        index index.html;
        add_header X-Server-Name test-origin;
        add_header X-Request-ID $request_id;
    }

    # Admin endpoint (for WAF rule testing)
    location /admin {
        try_files /admin.html =404;
        add_header X-Protected-Endpoint true;
    }

    # API endpoint (for rate limiting tests)
    location /api {
        default_type application/json;
        add_header X-API-Version 1.0;
        try_files /api.json =404;
    }

    # Echo endpoint (returns request details)
    location /echo {
        default_type application/json;
        return 200 '{"method":"$request_method","uri":"$request_uri","headers":{"host":"$http_host","user_agent":"$http_user_agent","x_real_ip":"$http_x_real_ip"},"remote_addr":"$remote_addr","timestamp":"$date_gmt"}';
    }

    # Slow endpoint (for latency testing - 2 second delay)
    location /slow {
        echo_sleep 2;
        default_type application/json;
        return 200 '{"message":"slow response","delay_seconds":2}';
    }

    # Error endpoint (always returns 500)
    location /error {
        return 500 '{"error":"Internal Server Error","code":500}';
    }

    # 404 handler
    location @404 {
        default_type application/json;
        return 404 '{"error":"Not Found","uri":"$request_uri"}';
    }
}
