<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SecBeat API Documentation - Management and Control APIs">
    <title>API Documentation - SecBeat</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/docs.css">
</head>
<body>
    <div class="background">
        <div class="stars"></div>
        <div class="grid-overlay"></div>
    </div>

    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">
                <span class="logo">üõ°Ô∏è</span>
                <span class="brand-name">SecBeat</span>
                <span class="version">v1.0</span>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="platform.html">Platform</a>
                <a href="deployment.html">Deployment</a>
                <a href="quickstart.html">Quick Start</a>
                <a href="https://github.com/fabriziosalmi/secbeat" target="_blank" class="btn-github">
                    <span>‚≠ê</span>
                    <span>GitHub</span>
                </a>
            </div>
        </div>
    </nav>

    <main class="docs-container">
        <aside class="docs-sidebar">
            <div class="sidebar-content">
                <h3>On This Page</h3>
                <ul class="toc">
                    <li><a href="#overview">API Overview</a></li>
                    <li><a href="#authentication">Authentication</a></li>
                    <li><a href="#management">Management API</a></li>
                    <li><a href="#orchestrator">Orchestrator API</a></li>
                    <li><a href="#metrics">Metrics Endpoints</a></li>
                    <li><a href="#webhooks">Webhooks</a></li>
                    <li><a href="#examples">Examples</a></li>
                </ul>
            </div>
        </aside>

        <article class="docs-content">
            <header class="docs-header">
                <h1>üì° API Documentation</h1>
                <p class="lead">RESTful APIs for managing and controlling SecBeat</p>
            </header>

            <section id="overview" class="doc-section">
                <h2>API Overview</h2>
                <p>SecBeat provides comprehensive RESTful APIs for management, monitoring, and control operations.</p>

                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">üîß</div>
                        <h4>Management API</h4>
                        <p>Port: 9999</p>
                        <span class="tag">Mitigation Node</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üéØ</div>
                        <h4>Orchestrator API</h4>
                        <p>Port: 3030</p>
                        <span class="tag">Control Plane</span>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">üìä</div>
                        <h4>Metrics API</h4>
                        <p>Ports: 9090, 9091, 9191</p>
                        <span class="tag">Prometheus</span>
                    </div>
                </div>
            </section>

            <section id="authentication" class="doc-section">
                <h2>Authentication</h2>
                <p>All API requests require authentication via API keys in headers.</p>

                <h3>API Key Header</h3>
                <div class="code-block">
                    <code>X-SecBeat-API-Key: your-api-key-here</code>
                </div>

                <h3>Example Request</h3>
                <div class="code-block">
                    <code>curl -H "X-SecBeat-API-Key: your-key" \
  http://localhost:9999/api/v1/status</code>
                </div>

                <div class="warning-box">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <h4>Security Warning</h4>
                        <p>Always change default API keys in production! Set via <code>MANAGEMENT_API_KEY</code> environment variable.</p>
                    </div>
                </div>
            </section>

            <section id="management" class="doc-section">
                <h2>Management API</h2>
                <p>Control mitigation node operations, rules, and configuration.</p>

                <h3>GET /api/v1/status</h3>
                <p>Get current node status and health information.</p>
                <div class="code-block">
                    <code>curl http://localhost:9999/api/v1/status

Response:
{
  "status": "running",
  "mode": "l7",
  "uptime_seconds": 86400,
  "connections": {
    "active": 1247,
    "total": 524288
  },
  "health": "healthy"
}</code>
                </div>

                <h3>POST /api/v1/rules</h3>
                <p>Add a new WAF rule dynamically.</p>
                <div class="code-block">
                    <code>curl -X POST http://localhost:9999/api/v1/rules \
  -H "Content-Type: application/json" \
  -d '{
    "pattern": "(?i)(union.*select|select.*from)",
    "action": "block",
    "severity": "high"
  }'

Response:
{
  "id": "rule_12345",
  "status": "active",
  "created_at": "2025-11-08T10:30:00Z"
}</code>
                </div>

                <h3>GET /api/v1/rules</h3>
                <p>List all active WAF rules.</p>
                <div class="code-block">
                    <code>curl http://localhost:9999/api/v1/rules

Response:
{
  "rules": [
    {
      "id": "rule_12345",
      "pattern": "(?i)(union.*select)",
      "action": "block",
      "hits": 42
    }
  ],
  "total": 50000
}</code>
                </div>

                <h3>DELETE /api/v1/rules/:id</h3>
                <p>Remove a WAF rule.</p>
                <div class="code-block">
                    <code>curl -X DELETE http://localhost:9999/api/v1/rules/rule_12345</code>
                </div>

                <h3>POST /api/v1/blacklist</h3>
                <p>Add an IP to the blacklist.</p>
                <div class="code-block">
                    <code>curl -X POST http://localhost:9999/api/v1/blacklist \
  -H "Content-Type: application/json" \
  -d '{
    "ip": "192.0.2.100",
    "reason": "repeated attacks",
    "duration_seconds": 3600
  }'</code>
                </div>

                <h3>GET /api/v1/stats</h3>
                <p>Get detailed statistics.</p>
                <div class="code-block">
                    <code>curl http://localhost:9999/api/v1/stats

Response:
{
  "packets_processed": 2500000,
  "attacks_blocked": 1247,
  "requests_per_second": 50000,
  "latency_ms": 0.3,
  "cpu_percent": 12,
  "memory_mb": 256
}</code>
                </div>
            </section>

            <section id="orchestrator" class="doc-section">
                <h2>Orchestrator API</h2>
                <p>Fleet management and control plane operations.</p>

                <h3>GET /api/v1/nodes</h3>
                <p>List all registered mitigation nodes.</p>
                <div class="code-block">
                    <code>curl http://localhost:3030/api/v1/nodes

Response:
{
  "nodes": [
    {
      "id": "node-1",
      "address": "10.0.1.10:9090",
      "status": "healthy",
      "mode": "l7",
      "load": 0.12
    },
    {
      "id": "node-2",
      "address": "10.0.1.11:9090",
      "status": "healthy",
      "mode": "syn",
      "load": 0.08
    }
  ]
}</code>
                </div>

                <h3>POST /api/v1/policy</h3>
                <p>Deploy a security policy to all nodes.</p>
                <div class="code-block">
                    <code>curl -X POST http://localhost:3030/api/v1/policy \
  -H "Content-Type: application/json" \
  -d '{
    "name": "strict-mode",
    "rules": [
      {"type": "rate_limit", "value": 1000},
      {"type": "geo_block", "countries": ["CN", "RU"]}
    ]
  }'</code>
                </div>

                <h3>POST /api/v1/scale</h3>
                <p>Trigger manual scaling operation.</p>
                <div class="code-block">
                    <code>curl -X POST http://localhost:3030/api/v1/scale \
  -d '{"action": "scale_up", "count": 2}'</code>
                </div>

                <h3>GET /api/v1/threats</h3>
                <p>Get threat intelligence summary.</p>
                <div class="code-block">
                    <code>curl http://localhost:3030/api/v1/threats

Response:
{
  "active_threats": 15,
  "top_attackers": [
    {"ip": "192.0.2.50", "attacks": 542},
    {"ip": "203.0.113.100", "attacks": 387}
  ],
  "attack_types": {
    "syn_flood": 8,
    "http_flood": 5,
    "slowloris": 2
  }
}</code>
                </div>
            </section>

            <section id="metrics" class="doc-section">
                <h2>Metrics Endpoints</h2>
                <p>Prometheus-compatible metrics for monitoring.</p>

                <h3>Mitigation Node Metrics</h3>
                <div class="code-block">
                    <code># Port 9090 - Public metrics
curl http://localhost:9090/metrics

# Port 9191 - Internal metrics
curl http://localhost:9191/metrics</code>
                </div>

                <h3>Key Metrics</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>secbeat_packets_processed_total</code></td>
                            <td>Counter</td>
                            <td>Total packets processed</td>
                        </tr>
                        <tr>
                            <td><code>secbeat_attacks_blocked_total</code></td>
                            <td>Counter</td>
                            <td>Total attacks blocked</td>
                        </tr>
                        <tr>
                            <td><code>secbeat_latency_seconds</code></td>
                            <td>Histogram</td>
                            <td>Request latency distribution</td>
                        </tr>
                        <tr>
                            <td><code>secbeat_connections_active</code></td>
                            <td>Gauge</td>
                            <td>Current active connections</td>
                        </tr>
                        <tr>
                            <td><code>secbeat_cpu_usage_percent</code></td>
                            <td>Gauge</td>
                            <td>CPU usage percentage</td>
                        </tr>
                        <tr>
                            <td><code>secbeat_memory_usage_bytes</code></td>
                            <td>Gauge</td>
                            <td>Memory usage in bytes</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="webhooks" class="doc-section">
                <h2>Webhooks</h2>
                <p>Configure webhooks to receive real-time event notifications.</p>

                <h3>Configuration</h3>
                <div class="code-block">
                    <code>[webhooks]
enabled = true
endpoints = [
  "https://your-app.com/webhooks/secbeat"
]
events = ["attack_detected", "node_health", "rule_triggered"]</code>
                </div>

                <h3>Event Payload Example</h3>
                <div class="code-block">
                    <code>{
  "event": "attack_detected",
  "timestamp": "2025-11-08T10:45:30Z",
  "node_id": "node-1",
  "data": {
    "attack_type": "syn_flood",
    "source_ip": "192.0.2.100",
    "packets_per_second": 100000,
    "action": "blocked"
  }
}</code>
                </div>
            </section>

            <section id="examples" class="doc-section">
                <h2>Usage Examples</h2>

                <h3>Python Example</h3>
                <div class="code-block">
                    <code>import requests

API_KEY = "your-api-key"
BASE_URL = "http://localhost:9999/api/v1"

headers = {"X-SecBeat-API-Key": API_KEY}

# Get status
response = requests.get(f"{BASE_URL}/status", headers=headers)
status = response.json()
print(f"Status: {status['status']}")

# Add rule
rule = {
    "pattern": "(?i)script.*alert",
    "action": "block",
    "severity": "high"
}
response = requests.post(f"{BASE_URL}/rules", json=rule, headers=headers)
print(f"Rule created: {response.json()['id']}")</code>
                </div>

                <h3>Bash Script Example</h3>
                <div class="code-block">
                    <code>#!/bin/bash
API_KEY="your-api-key"
BASE="http://localhost:9999/api/v1"

# Monitor stats every 5 seconds
while true; do
  curl -s -H "X-SecBeat-API-Key: $API_KEY" \
    "$BASE/stats" | jq '.requests_per_second'
  sleep 5
done</code>
                </div>

                <h3>JavaScript Example</h3>
                <div class="code-block">
                    <code>const API_KEY = 'your-api-key';
const BASE_URL = 'http://localhost:9999/api/v1';

async function getStatus() {
  const response = await fetch(`${BASE_URL}/status`, {
    headers: {'X-SecBeat-API-Key': API_KEY}
  });
  const data = await response.json();
  console.log('Status:', data);
}

getStatus();</code>
                </div>
            </section>

            <footer class="docs-footer">
                <div class="footer-nav">
                    <a href="quickstart.html" class="nav-prev">‚Üê Quick Start</a>
                    <a href="index.html" class="nav-next">Home ‚Üí</a>
                </div>
            </footer>
        </article>
    </main>

    <script src="js/main.js"></script>
</body>
</html>
